#!/usr/bin/env ruby

require 'vcloud/launcher'

banner_text = <<EOF
vcloud-launch [options] config_file

vcloud-launch takes a configuration describing a vCloud Org,
and tries to make it a reality.

See https://github.com/gds-operations/vcloud-tools for more info
EOF

opts = Trollop::options do
  banner banner_text

  opt :power_on,          "Power on VMs",          default: true
  opt :continue_on_error, "Ignore errors",         default: false
  opt :verbose,           "Enable verbose output", default: false
  opt :quiet,             "Reduced output",        default: false
  opt :version,           "Show version",          default: false

  conflicts :verbose, :quiet
end

if opts[:version]
  puts Vcloud::Launcher::VERSION
  exit
end

config_file = ARGV.shift

Trollop::die "You must supply a configuration file" unless config_file

begin
  launcher = Vcloud::Launcher::Launch.new(config_file, opts)
  launcher.run
rescue => e
  warn e.message
  exit 1
end

